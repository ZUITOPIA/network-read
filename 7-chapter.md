### Chap7. 스위치&라우터에 대해 배워보자 - 라우팅 시스템

```
같은 네트워크 내부에서는 '스위치'에 의해 데이터 전송이 이루어짐

(스위치 : MAC 주소 기반으로 데이터를 전송하는 네트워크 장비)
```

### 01. MAC 주소, ARP 테이블 확인하기

step1. PC의 MAC 주소 확인하기

-   명령어 : ipconfig /all

step2. ARP 테이블 확인하기

어떠한 통신을 할 때는 반드시 IP 주소를 지정해야 하는데, ARP에 의해 자동으로 MAC 주소와 IP 주소가 매핑됨. 그리고 매핑된 주소는 ARP 테이블에 저장됨.

-   명령어 : arp -a

### 01-1. 스위치의 구조

스위치의 역할

-   PC나 서버 등을 네트워크에 연결시킴
-   같은 네트워크 내부의 LAN 포트 사이에서 데이터 전송을 수행함
    (어느 LAN 포트로 전송할 지 판단하기 위해 이용되는 것이 MAC 주소)

스위치 특징

-   스위치에는 LAN 포트가 여러개 달려 있음 (가정용 스위치에는 대개 8개, 기업용 스위치에는 몇백 개)

컴퓨터를 네트워크에 연결 = 컴퓨터와 스위치의 LAN 포트를 서로 연결 (즉, 스위치를 통해 네트워크에 접속함)
=> 스위치가 여러 대의 컴퓨터로부터 LAN 케이블을 모으는 것 처럼 보이기 때문에 '접선 장치'라고도 부름

스위치에 연결된 컴퓨터들은 같은 네트워크에 연결됨 (스위치를 여러 대 사용하는 경우에도 같은 네트워크로 취급)

```
1. MAC 주소 (LAN 포트의 주소)
- 원칙상 변경할 수 없음 => 그래서 '하드웨어 주소', '물리적 주소'라고도 불림
    (단, 소프트웨어로 MAC 주소를 변경할 수 있는 LAN 포트도 있음)
- 48비트 (48개의 '0'과 '1' 조합) => 알아보기 어려우니 8비트씩 끊어서 16진수로 변환하여 표시함
- 48비트의 MAC 주소는 상위 24비트와 하위 24비트가 각각 다른 의미를 가짐
- 구성 : 벤더코드 + 시리얼 번호
```

-   상위 24비트 -> 주요 벤더 코드
    | 벤더 코드 | 벤더 |
    | :-------: | :-------------: |
    | 00-00-0C | 시스코 시스템즈 |
    | 00-00-0E | 후지쯔 |
    | 00-00-3D | AT&T |
    | 00-00-4C | NEC |
    | 00-00-87 | 히타치 |
    | 00-60-B0 | 휴렉 팩커드(HP) |
    | 00-AA-00 | Intel |
    | 00-C0-4F | Dell |

-   하위 24비트 : 네트워크 장비 벤더가 제조한 LAN 포트를 관리하기 위한 '시리얼 번호'로 사용

```
2. 스위치의 데이터 전송
- 스위치는 MAC 주소로 데이터를 전송함
- 스위치는 MAC 주소들이 전송되는 'MAC 주소 테이블'을 가짐 (스위치의 전원이 막 켜진 경우 : 테이블 텅 비어있음)

현재 상황 : 스위치 - PC A 포트1, PC B 포트2, PC C 포트3, PC D 포트4 가 연결되어 있는 경우

예시 1.
(1) MAC 주소 A가 MAC 주소 B와 통신하고 싶을 때
(2) 수신한 데이터의 송신지 MAC 주소를 체크하여 MAC 주소 테이블에 등록함  (송신지 A, 포트 1)
(3) 목적지 MAC 주소와 MAC 주소 테이블을 가지고 데이터를 전송할 곳을 판단함
    - A가 데이터를 전송했을 때 목적지가 B인데 MAC 주소 테이블에 B의 정보가 없으므로, A의 포트 1을 제외한 포트 2,3,4에 데이터가 전송됨

예시 2.
(1) MAC 주소 A가 MAC 주소 B와 통신하고 싶을 때 (MAC 주소 테이블에는 A : 포트1 , B : 포트2 존재)
(2) 수신한 데이터의 송신지 MAC 주소를 체크하여 MAC 주소 테이블에 등록함 (A : 포트1 , B : 포트2)
(3) 목적지 MAC 주소와 MAC 주소 테이블을 가지고 데이터를 전송할 곳을 판단함
    - A가 포트 1이라는 정보가 있고, 데이터를 전송했을 때 목적지인 B의 포트 2로 데이터를 전송함
(4) 브로드캐스트 MAC 주소를 기반으로 통신함 (목적지 MAC : FF-FF-FF-FF-FF-FF)
(5) 수신 포트 이외의 모든 포트로 전송 (스위치 1대당 '브로드캐스트 도메인(네트워크 하나의 범위)' 1개)
```

특징

-   PC에 연결된 포트가 바뀔 수 있음
-   연결된 PC가 바뀌면 PC의 MAC 주소 변경됨
    => 스위치의 MAC 주소 테이블이 언제든 변할 수 있음(MAC 주소 테이블의 데이터에는 제한 시간이 존재함)
    > PC가 연결되어 데이터를 전송하는 동안에는 MAC 주소 테이블에 MAC 주소 등록이 유지됨, 그러나 제한 시간 내에 데이터 전송이 이루어지지 않으면 MAC 주소의 데이터는 삭제됨

### 01-2. ARP

통신할 때에는 반드시 IP 주소를 지정해야하는데 그 IP 주소에 매핑된 MAC 주소를 알아내기 위한 프로토콜  
(데이터를 송신할 때 ARP에 의해 목적지의 MAC 주소가 자동으로 지정됨)

```
ARP 요청 (ARP request) -> 브로드캐스트로 송신됨 (같은 네트워크 내부의 모든 PC를 대상으로 지정한 IP 주소에 매핑된 MAC 주소를 질의하는 것)

ARP 응답 (ARP reply)
- ARP 요청에서 질의된 IP 주소를 가진 PC가 ARP 응답으로 MAC 주소를 알림
```

### 02. 라우터

네트워크는 라우터에 의해 상호 연결되어 있음

```
라우터의 인터페이스 1의 IP 주소 : 192.168.1.254/24

라우터의 인터페이스 2의 IP 주소 : 192.168.2.254/24

=> 라우터는 192.168.1.0/24와 192.168.2.0/24의 네트워크를 서로 연결함

라우터의 인터페이스에는 스위치가 연결되거나 PC나 서버 등이 직접 연결되기도 함(+ 라우터끼리 직접 연결되는 경우도 있음)
네트워크 간의 데이터 전송도 라우터에 의해 이루어짐
=> 이 때, 라우터에 의한 데이터 전송을 '라우팅'이라고 부름

라우팅을 올바르게 하기 위해서 -> 미리 라우터에 '라우팅 테이블'을 작성해두어야 함
라우팅 테이블 : 데이터를 전송할 네트워크의 정보가 등록되어 있음
라우팅 동작 : 최적 루트 학습, 데이터 전송

라우터 => 수신한 데이터의 목적지 IP주소와 라우팅 테이블을 가지고 데이터 전송을 수행함
```

### 02-1. 라우터의 구조

```
라우터의 역할
- 네트워크의 상호 연결을 수행함
- 네트워크 간의 데이터 전송을 수행함
```

브로드밴드 라우터 : 가정에서 사용하는 인터넷 접속용 라우터 (WAN 포트와 LAN 포트 존재)

-   기능 : 인터넷에 접속하는 기능 + 스위치 기능
-   LAN 포트 = 스위치 역할

```
라우팅 테이블에 등록될 라우트 정보의 주요 구성요소
1. 라우트 정보의 정보원
2. 네트워크 ID/서브넷 마스크
3. 메트릭
4. 관리 거리 (AD, Administrative Distance)
5. 다음 홉 주소 (Next hop address)
6. 출력 인터페이스
7. 경과 시간
```

```
라우트 정보 등록
- 직접 연결
- 정적 라우팅
- 라우팅 프로토콜
```

### 02-2. 데이터 전송의 전체적인 흐름

| 스위치와 라우터의 데이터 전송의 특징  |       스위치        |      라우터       |
| :-----------------------------------: | :-----------------: | :---------------: |
|          데이터의 전송 범위           | 같은 네트워크 내부  |   네트워크 사이   |
|      전송을 위해 이용하는 테이블      |   MAC 주소 테이블   |   라우팅 테이블   |
|        전송할 때 참조하는 주소        |      MAC 주소       |      IP 주소      |
| 테이블에 필요한 정보가 없을 때의 동작 | 데이터를 플러딩한다 | 데이터를 파기한다 |
