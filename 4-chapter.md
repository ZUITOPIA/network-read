### TCP와 UDP란 무엇인가?

```
TCP와 UDP : 적절한 애플리케이션과 데이터를 주고받기 위해 사용되는 프로토콜
```

### 포트번호를 확인하기 위한 명령어

```
netstat -n      // -n은 IP 주소와 포트번호를 숫자 형식으로 출력하기 위한 옵션
```

실행 결과 화면의 로컬 주소, 외부 주소 항목에서 : 앞부분이 IP 주소, 뒷부분이 포트 번호임  
ex. 127.0.0.1(IP 주소) : 1390 (포트번호) => 플로우 포맷

플로우 / 애플리케이션 플로우 : 애플리케이션이 통신으로 주고받는 일련의 데이터  
플로우는 '목적지/송신지 주소'와 '포트 번호'로 식별됨  
(동일한 애플리케이션의 데이터에는 모두 동일한 IP 주소 및 포트 번호가 지정됨)

### 포트 번호

```
포트 번호 : PC나 서버상에서 동작하는 애플리케이션을 식별하기 위한 정보

1. 데이터를 전송할 호스트를 IP 주소로 지정함
2. PC로 전송된 데이터는 포트 번호로 지정된 애플리케이션으로 분배됨

포트 번호를 기반으로 애플리케이션 데이터를 분배하는 역할을 하는 프로토콜 => TCP / UDP

```

### 포트 번호의 범위

```
포트 번호 : 16 비트의 숫자 형식 (0 ~ 65535)이며 용도에 따라 범위가 나뉨
1. 잘 알려진 포트 : 0 ~ 1023
2. 등록된 포트 : 1024 ~ 49151
3. 동적 / 개인적 포트 : 49152 ~ 65535

서버 : 클라이언트가 보낸 요청을 받아들여 처리하는 역할을 함 -> 이 때 포트 번호가 지정되어 있지 않으면 클라이언트가 서버 애플리케이션에 접근할 수 없으므로 서버와 클라이언트 간의 통신에는 잘 알려진 포트를 사용해야 함
```

1. 주로 사용되는 잘 알려진 포트

| 프로토콜 | TCP 포트 번호 | UDP 포트 번호 |
| :------: | :-----------: | :-----------: |
|   HTTP   |      80       |       -       |
|  HTTPS   |      443      |       -       |
|   SMTP   |      24       |       -       |
|   POP3   |     1120      |       -       |
|   IMAP   |      143      |       -       |
|   DNS    |      53       |      53       |
|   DHCP   |       -       |     67/68     |
|   NTP    |       -       |      123      |
|   FTP    |     20/21     |       -       |
|   TFTP   |       -       |      69       |

2. 등록된 포트  
   ex. 웹 프록시 서버에서 일반적으로 이용하는 '8080'

3. 동적/개인적 포트

-   서버 애플리케이션이 클라이언트 애플리케이션으로 응답을 보낼 때 사용됨
-   주로 '클라이언트 애플리케이션'을 식별하기 위한 것
-   클라이언트 애플리케이션이 통신할 때에는 동적/개인적 포트의 범위 내에서 랜덤으로 포트 번호를 할당함

### 웹 사이트를 탭 여러 개로 띄울 수 있는 이유

1.  각각의 웹 브라우저 윈도우에 개별적인 동적/개인적 포트가 할당됨
2.  각 윈도우는 인터넷 상의 웹 서버에 80번 포트로 접속
3.  이 때의 송신지 포트 번호는 각각 할당받는 동적/개인적 포트
4.  요청을 받은 웹 서버는 이 동적/개인적 포트로 응답을 돌려보냄

### 포트 번호는 고정되어 있지 않다

클라이언트 애플리케이션에서 사용하는 포트 번호는 어떠한 통신이 발생할 때 마다 OS로부터 자동으로 할당되며, 통신이 종료되면 할당이 해제됨 (통신 할 때에만 일시적 할당)

> 포트 번호 자동 할당 범위는 OS의 버전에 따라 달라질 수 있음

### TCP란

> 프로토콜 : 컴퓨터끼리 통신할 때에 정해져 있는 '공통된 절차의 규약'
> 다양한 프로토콜의 예 : IP, HTTP, FTP, SMTP 등 ...

-   다양한 프로토콜들 중, 적절한 애플리케이션 데이터를 전달하기 위해서 이용되는 프로토콜 (Transmission Control Protocol)
-   데이터 전달 외에 데이터를 분할하는 기능도 있음

TCP에 의한 애플리케이션 데이터 전달이나 전송 데이터의 분할을 수행하기 위해서

-   전송될 데이터에는 TCP 헤더가 추가됨 => 'TCP 세그먼트'라고 부름
    -   헤더 : 데이터 본체와는 별도로 데이터의 맨 앞에 추가되는 정보

### TCP 연결 성립

Three-way handshake 기법을 사용하여 TCP 연결

> Three-way handshake 기법 : 데이터 전송을 수행하는 애플리케이션끼리 인사를 3번 함
> A : 연결해도 될까요? (연결 요구 : SYN 플래그)
> B : 네. 이쪽에서도 연결하겠습니다. (응답 : SYN/ACK 플래그)
> A : 알겠습니다. (응답 : ACK 플래그)

### TCP 연결 종료

통신을 시작할 때처럼, 통신을 종료할 때에도 규칙적으로 인사를 나눔 (4개의 segment를 거쳐 정상 종료)

> A : 연결을 종료해도 될까요? (종료 요구 : FIN/ACK 플래그)
> B : 네. 괜찮습니다. (종료 요구 확인 : ACK 플래그)
> B : 이쪽에서도 연결을 종료하겠습니다. (종료 의사 : FIN/ACK 플래그)
> A : 네. 알겠습니다. (종료 요구 확인 : ACK 플래그)

### 데이터 전송 시의 동작

1. 윈도우 제어

    - 얼만큼의 TCP 세그먼트들을 한 번에 보낼 것인가를 제어하는 시스템
    - TCP 윈도우 사이즈에 따라 한 번에 보낼 수 있는 양이 달라짐 (윈도우 사이즈는 가변적임)
        - 여러 개를 한꺼번에 보내다 보면 수신하는 쪽에 도착하는 순서가 바뀔 수 있음
          => 순서 제어 시스템 (TCP 헤더의 시퀀스 번호에 의해 TCP 세그먼트 순서대로 정렬)

2. 재전송 제어

    - TCP 세그먼트가 네트워크상에서 전송될 때 데이터가 유실되면 TCP 세그먼트를 재전송하는 시스템
        - TCP 세그먼트를 송신했을 때 RTO(Retransmission Time Out) 시간 이내에 확인 응답을 받지 못 할 시 데이터가 유실된 것으로 판단함
        - RTO 발생 원인 : TCP 세그먼트 유실, 확인 응답 유실, 응답 전송이나 처리가 오래걸림

3. 혼잡 제어

-   TCP 세그먼트가 유실되는 원인의 대부분은 네트워크의 혼잡 때문
    -   윈도우 제어로 한 번에 많은 TCP 세그먼트들을 송신하는 것이 문제
-   네트워크 혼잡으로 TCP 세그먼트가 유실됐을 경우 재전송 제어로 다시 재전송하더라도 또 다시 유실됨
-   그래서 네트워크의 혼잡을 회피하는 시스템이 필요

혼잡 제어 방법 : 한 번에 많은 TCP 세그먼트들을 송신하지 않고, 송신할 TCP 세그먼트들을 서서히 늘려가며 네트워크의 혼잡을 회피함 => 슬로우 스타트 알고리즘 방식

### UDP란 ?

TCP처럼 포트 번호에 따라 적절한 애플리케이션에 데이터를 전달하기 위한 프로토콜

UDP 용도

-   실시간 데이터 전송할 때 (전화)
-   여러 상대에게 같은 내용의 데이터 전송할 때(화상 회의)
-   데이터 전송 시 신뢰성이 필요하지 않은 소량의 데이터를 전송할 때(DNS 이름 해석)

### TCP / UDP 비교

TCP와 : UDP는 데이터를 전달할 때 말고는 아무것도 하지 않음, 애플리케이션에 데이터를 전달하는 것만이 목적

|          차이점           |                                                            TCP                                                             |                                         UDP                                         |
| :-----------------------: | :------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------: |
|         통신 방식         |                                                      연결형 프로토콜                                                       |                                  비연결형 프로토콜                                  |
|           용도            |                                     시간 제약 없이 신뢰성이 필요한 데이터를 전송할 때                                      | 실시간 데이터 전송 / 브로드캐스트나 멀티캐스트 / 소량의 데이터를 빈번하게 전송할 때 |
|         주요 기능         |                           데이터 전송 뿐만 아니라 연결 성립, 재전송 제어, 윈도우 제어, 혼잡 제어                           |                                 오로지 데이터 전송                                  |
|     헤더에 담긴 정보      | 송신지 포트 번호, 목적지 포트 번호, 시퀀스 번호, ACK 번호, 데이터 오프셋, 예약, 플래그, 윈도우 사이즈, 체크섬, 긴급 포인터 |            송신지 포트 번호, 목적지 포트 번호, 데이터그램의 길이, 체크섬            |
|         헤더 표준         |                                                          20바이트                                                          |                                       8바이트                                       |
|         오버헤드          |                                                    큼 (통신 효율 낮음)                                                     |                                작음 (통신 효율 높음)                                |
|          신뢰성           |                                                            높음                                                            |                                        낮음                                         |
| 헤더 + 데이터를 합친 이름 |                                                        TCP 세그먼트                                                        |                                   UDP 데이터그램                                    |

### 포트를 열다

포트 포워딩, 포트 매팅, 포트 전송 : 원래대로라면 인터넷 쪽에서 데이터를 보내는 것은 불가능, 그러나 인터넷 쪽에서 먼저 통신을 시작하여 홈 네트워크 내부의 특정 PC에게 패킷을 보낼 수 있게 하는 것 (IP 주소 변환을 수행하는 것)

> 주의!  
> 일반적인 브로드밴드 라우터에는 기본적인 보안 기능이 갖추어져 있어 인터넷 상의 악성 유저들로부터 홈 네트워크를 방어할 수 있도록 도와줌 (ex. 방화벽 기능)  
> 그러나 포트를 열어둠으로써 악성 유저들이 열려 있는 포트로 바이러스 등을 보내올 수 있기 때문에 보안 대책이 필요함

UPnP로 브로드밴드 라우터에서 포트를 여는 설정을 자동화할 수 있음
