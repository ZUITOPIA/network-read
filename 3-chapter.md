### DNS란 ?

-   호스트명(컴퓨터의 이름)과 IP주소를 매핑해주는 시스템
-   우리가 평소 IP 주소 대신 '호스트명'으로 네트워크 통신할 수 있는 것은 DNS 덕분
-   인터넷 통신을 지탱하는 매우 중요한 시스템
-   DNS가 필요한 이유 :  
    TCP/IP 네트워크에서 통신하기 위해서는 반드시 IP 주소가 필요(모든 애플리케이션은 통신할 때 반드시 IP 주소를 지정함)  
    그러나 IP 주소는 0과 1이 32번 반복되는 비트의 나열로 이루어져있기 때문에 사람이 기억하기 어려움 -> 그래서 사람이 알기 쉽게 하고자 컴퓨터에 '호스트명(이름)'을 붙이고 호스트명으로 통신 상대를 지정할 수 있게 만든 것  
    ( 주의 , 호스트명으로 통신 상대를 지정하더라도 통신 상대의 IP 주소는 여전히 필요함 )

### 쉽게 이해하기

DNS : 네트워크의 '전화번호부' 역할
DNS 서버 : 전화번호 안내 서비스 '114' 역할

### DNS 서버를 잘못 설정하면 ?

-   DNS 서버의 IP주소가 올바르게 설정되어 있는 경우 : 웹사이트 정상적으로 표시됨
-   DNS 서버의 IP주소 설정을 변경한 경우 : 웹사이트 정상적으로 표시 X
-   DNS 서버의 IP 주소가 잘못 설정된 상태 그대로 기존 IP주소로 접속한 경우 : 웹사이트 자체는 표시되지만 화면 일부 표시 X

### DNS의 구조

-   리소스 레코드
    -> 호스트명과 IP 주소의 매핑  
    (DNS로 이름을 해석하기 위해서는 DNS 서버에 호스트명과 IP 주소의 매핑을 등록해야 함)

| 타입  | 의미                        |
| ----- | --------------------------- |
| A     | 호스트명에 매핑된 IP 주소   |
| AAAA  | 호스트명에 매핑된 IPv6 주소 |
| CNAME | 호스트명에 매핑된 별칭      |
| MX    | 도메인명에 매핑된 메일 서버 |
| NS    | 도메인명에 매핑된 DNS 서버  |
| PTR   | IP 주소에 매핑된 호스트명   |

### 도메인과 존

-   도메인 : 호스트명의 집합, 기업 등의 조직에 의해 관리되며 도메인 내의 호스트에는 공통된 호스트명이 부여됨  
    (도메인은 또 다시 서브 도메인으로 나눌 수 있음)
-   존 : DNS 서버가 관리하는 범위 (ex. 어떤 DNS 서버에 등록된 리소스 레코드의 집합 => 존 파일 / 존 정보 라고 부름)

도메인 예 :  
DNS 서버 -> dns.n-study.com  
웹 서버 -> www.n-study.com  
메일 서버 -> mail.n-study.com  
PC -> pc1.n-study.com

서브 도메인 예 :  
DNS 서버 -> dns.sub.n-study.com  
PC -> pc1.sub.n-study.com

### 도메인의 계층

도메인을 계층화하여 관리하는 이유 : 인터넷에는 세계 각국에 위치한 다양한 조직들의 네트워크가 연결돼 있으며 수 많은 호스트들이 존재함 -> 다양한 호스트들과 효율적으로 통신하기 위함

도메인의 계층 : 루트를 정점으로 한 트리 구조

루트 DNS 서버는 전 세계에 13개 존재하며 각각 다양한 조직에 의해 관리되고 있음
루트 DNS 서버의 호스트명 : *.ROOT-SERVER.NET ( *자리에는 A부터 M까지의 알파벳이 들어감)

| 루트 DNS 서버 | 운용 조직                                                   |
| ------------- | ----------------------------------------------------------- |
| A             | VeriSign, Inc.                                              |
| B             | USC information Sciences Institute(ISI)                     |
| C             | Cogent Communications                                       |
| D             | 메릴랜드 대학교                                             |
| E             | 미국 항공우주국(NASA) 에임스 연구소                         |
| F             | Internet Systems Consortium, Inc.                           |
| G             | 미국 국방성 네트워크 인포메이션 센터                        |
| H             | 미국 육군 연구소                                            |
| I             | Autonomica                                                  |
| J             | VeriSign, Inc.                                              |
| K             | Reseaux IP Europeens -Network Coordination Center(RIPE NCC) |
| L             | Internet Corporation for Assigned Names and Numbers (ICANN) |
| M             | WIDE Project                                                |

### DNS 이름 해석이란 ?

-   DNS 서버에 네임 쿼리를 송신해서 목적 호스트명에 매핑된 IP 주소를 질의하는 과정
-   DNS 서버는 네임 쿼리의 응답으로써 호스트명에 매핑된 IP 주소를 반환함
-   자동으로 이루어지기 때문에 유저가 신경 쓸 일 없음

> 주의, 같은 도메인 내의 DNS 서버가 목적 호스트명과 IP 주소의 매핑 정보를 반드시 가지고 있으리라는 보장은 없음  
> 만일 해당하는 매핑 정보를 가지고 있지 않을 경우 루트로부터 도메인 계층 구조를 따라가며 질의를 계속 함
> 이때 DNS 서버에 질의를 보내는 클라이언트 => 리졸버 (Resolver)
> ( PC에 DNS 서버의 IP 주소를 올바르게 지정하면 리졸버로서 작동 )

### DNS 캐시를 확인하는 명령어

```
ipconfig /displaydns
```

### 홈 네트워크의 DNS 서버 설정

대부분의 경우 홈 네트워크에 속한 PC에는 브로드밴드 라우터의 IP 주소가 DNS 서버주소로 지정됨, 그리고 브로드밴드 라우터의 DNS 서버로는 계약한 ISP의 DNS 서버가 지정됨

단, DNS 리소스 레코드가 브로드밴드 라우터에 등록되어 있는 것은 아님!  
브로드밴드 라우터는 PC로부터 전송된 DNS 네임 쿼리를 ISP의 DNS 서버로 전송하는 역할을 할 뿐, 실제 그 네임 쿼리에 응답하는 것은 ISP의 DNS 서버임

### nslookup 명령어

사용하는 상황 : DNS 서버의 리소스 레코드 등록을 확인할 때, 어떠한 장애나 DNS 서버 설정 실수 등으로 DNS가 정상적으로 동작하지 않을 떄 (평소에는 신경 쓸 필요 X)

-   DNS 서버에 IP 주소를 수동으로 질의할 수 있음
-   두 가지 모드 (비대화 모드 / 대화 모드)
    -   비대화 모드 : nslookup 명령어 뒤에 호스트명과 같은 인수나 옵션을 직접 입력해서 지정하는 방법 -> 결과가 출력되자마자 명령어가 종료됨
    -   대화 모드 : 질의를 여러 번 연속해서 할 수 있음, 질의할 때마다 옵션이나 질의할 DNS 서버를 다르게 지정할 수도 있음, 대화모드를 종료할 때는 'exit' 입력 or 'Ctrl + c'

> A 레코드 질의
> A 레코드에는 호스트명에 매핑된 IP 주소가 등록되어 있음!
> DNS 서버에 들어오는 질의의 대다수가 A 레코드 질의임
> A 레코드 질의 방법 : 질의할 호스트명만 입력하면 됨 (ex. www.daum.net)

> PTR 레코드 질의
> IP 주소에 매핑된 호스트명의 정보를 알아냄
> (nslookup 명령어는 A 레코드 질의인지 PTR 레코드 질의인지 자동으로 판별함)

> MX 레코드 질의
> 메일 서버의 정보를 알아냄

> NS (Name Server) 레코드 질의
> 도메인명을 관리하는 DNS 서버의 정보

### DNS를 이용한 서버 부하분산

서버를 여러 대 운용하면 '서버 장애 리스크를 회피 가능'하다는 장점이 있음

가장 간단한 방식 : DNS를 이용한 'DNS 라운드 로빈' 방식 -> 웹사이트로 요청이 들어왔을 때 서버 여러 대가 순서대로 처리하도록 함 (DNS 서버 + 부하를 분산하기 위한 서버들 로 구성됨)

DNS 라운드 로빈 방식의 장점 : 전용 장비가 특별히 필요하지 않음  
DNS 라운드 로빈 방식의 단점 : 효율적인 부하 분산 불가능 (서버의 부하 편향), 서버 장애를 감지할 수 없음 -> 로드밸런서 도입하여 유연하게 분산하도록 함

### DNS 라운드 로빈 방식의 통신 플로우

1. PC1이 DNS 서버에게 www.example.com 의 DNS 쿼리를 송신함
2. DNS 서버는 DNS 응답으로 www.example.com 의 IP 주소 192.168.1.1을 반환함
3. PC1은 서버 1(192.168.1.1)로 접근함
4. PC2가 DNS 서버에게 www.example.com의 DNS 쿼리를 송신함
5. DNS 서버는 DNS 응답으로 www.example.com의 IP 주소 192.168.1.2를 반환함
6. PC2은 서버 2(192.168.1.2)로 접근함

### 동적 DNS (DDNS)

=> IP 주소가 변경되었을 때 DNS 서버에 이를 알림으로써 호스트명과 IP 주소 매핑을 동적으로 갱신하는 시스템 (호스트명과 IP 주소의 매핑 정보는 항상 변경할 수 있기 때문)
